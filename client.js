!function(){let e=meetings.find((e=>"na"==e.dataSource&&7360==e.id));e&&(e.audience=["Adults Welcome"])}();const audienceSynonyms={LGBT:"LGBTQIA+","LGBTIQ+ only":"LGBTQIA+","Men only":"Men","Women Only":"Women","Female only":"Women"};function flag(e,t){let n=[e];"na"==e?n=["us"]:"uk"==e&&(n=["gb"]);const a={us:"USA",ca:"Canada",uk:"UK",au:"Australia"},c=document.createElement("div");return c.className="flagwrapper",n.forEach((e=>{const t=document.createElement("img");t.src=`img/${e}.svg`,t.alt=a[e],t.height=32,t.width=32,t.className="flag",c.appendChild(t)})),c}function partsToDiv(e){const t=document.createElement("div");return e.forEach((e=>{if("literal"==e.type)t.append(e.value);else{const n=document.createElement("span");n.className=e.type.replace(/([A-Z])/,(e=>"-"+e.toLowerCase())),n.append(e.value),t.appendChild(n)}})),t}function findNextMeeting(e,t){if(!e?.time)return null;for(let n of[0,1]){const a=new Date;a.setUTCHours(e.time.slice(0,2)),a.setUTCMinutes(e.time.slice(3,5)),a.setUTCSeconds(0),a.setUTCMilliseconds(0),a.setUTCMonth(a.getUTCMonth()+n),a.setUTCDate(1);const c=(e.day-a.getUTCDay()+7)%7;a.setUTCDate(c+a.getUTCDate());for(let n of e.week||"12345"){const c=new Date(a.getTime());if(-1!=n)c.setUTCDate(c.getUTCDate()+7*(n-1));else{c.setUTCMonth(c.getUTCMonth()+1),c.setUTCDate(1);const t=(e.day-c.getUTCDay()+7)%7;c.setUTCDate(t+c.getUTCDate()-7)}if(c.getTime()+6e4*t>=(new Date).getTime())return c}}}function render(){const e=document.createElement("table"),t=document.createElement("tr");["Country","Time","Details","Location","Facilitator"].forEach((e=>{const n=document.createElement("th");n.append(e),t.appendChild(n)})),e.appendChild(t);const n=Intl.DateTimeFormat(void 0,{timeStyle:"short"}),a=Intl.DateTimeFormat(void 0,{weekday:"long",month:"long",day:"numeric"}),c=document.getElementById("program").value,o=document.getElementById("audience").value,d=document.getElementById("language").value,i=parseInt(document.getElementById("facilitator").value),l=document.getElementById("includehybrid").checked,r=meetings.filter((e=>(!c||e.program==c||"4-Point Recovery"==c&&("SMART Recovery"==e.program||"Standard"==e.program))&&(!o||e.audience.map((e=>audienceSynonyms[e]||e)).includes(o))&&(!d||e.language==d)&&(!i||(e.facilitator||[]).includes(i))&&(l||"Online"==e.type))).filter((e=>!!e.schedule)).map((e=>({...e,time:findNextMeeting(e.schedule,e.duration).toISOString()}))).sort(((e,t)=>e.time.localeCompare(t.time))),m=[];c&&m.push(`program=${encodeURIComponent(c)}`),o&&m.push(`audience=${encodeURIComponent(o)}`),d&&m.push(`language=${encodeURIComponent(d)}`),i&&m.push(`facilitator=${encodeURIComponent(i)}`),!l&&m.push("includehybrid=0");const s="?"+m.join("&");history.replaceState(null,"",s);const p=Object.groupBy(meetings.flatMap((e=>e.facilitator||[])),(e=>e)),u=Object.groupBy(r.flatMap((e=>e.facilitator||[])),(e=>e));for(let t of r){const c=document.createElement("tr"),o=document.createElement("td");o.appendChild(flag(t.dataSource,t.location)),c.appendChild(o);const d=new Date(t.time),i=new Date(d.getTime()+6e4*t.duration),l=document.createElement("td"),m=document.createElement("div"),s=partsToDiv(n.formatToParts(d));s.className="time start",m.appendChild(s);const g=partsToDiv(n.formatToParts(i));g.className="time end",m.append(" - "),m.appendChild(g);const h=(t.duration>=60?`${Math.floor(t.duration/60+1e-8)}h`:"")+("0"+t.duration%60).slice(-2),f=document.createElement("div");f.className="duration",f.append(h),m.appendChild(f),l.appendChild(m);const E=a.formatToParts(d);" "==E[3].value&&(E[3].value="Â ");const C=partsToDiv(E);C.className="date",l.appendChild(C),c.appendChild(l);const y=document.createElement("td");y.className="details";const v=document.createElement("div");v.append(t.program),y.appendChild(v);const T=document.createElement("div");t.audience.forEach(((e,t)=>{const n=document.createElement("span");n.append(e),t>0&&T.append(", "),T.appendChild(n)})),y.appendChild(T);const b=document.createElement("div");b.append(t.language),y.appendChild(b),c.appendChild(y);const I=document.createElement("td");if(I.className="location","Online"==t.type){const e=document.createElement("div");e.append(t.type),I.appendChild(e);const n=document.createElement("div");"National"!=t.location&&(n.className="host"),n.append(t.location),I.appendChild(n)}else{const e=document.createElement("div");e.append(t.location),I.appendChild(e);const n=document.createElement("div");n.className="plus-online",n.append("+ Online"),I.appendChild(n)}const U=document.createElement("td");t.facilitator&&t.facilitator.forEach(((e,t)=>{const n=facilitators[e][0],a=document.createElement("span");a.append(n),a.className="facilitator",t>0&&U.append(", ");const c=p[e]?.length||0,o=u[e]?.length||0;o>1&&o<r.length?(a.classList.add("multiple-visible"),a.title="This facilitator runs other meetings, click to see them."):c>o&&(a.classList.add("multiple-filtered"),a.title="This facilitator runs other meetings but they are not currently displayed, click to see them."),a.title&&a.addEventListener("click",(t=>{t.stopPropagation(),document.getElementById("facilitator").value=e,o<=1&&(document.getElementById("program").value="",document.getElementById("audience").value="",document.getElementById("language").value="",document.getElementById("includehybrid").checked=!0),render()})),U.appendChild(a)})),c.appendChild(I),c.appendChild(U),c.addEventListener("click",(()=>window.open(`https://${"na"==t.dataSource?"":t.dataSource+"."}meetings.smartrecovery.org/meetings/${t.id}/`))),c.className="meeting",new Date(t.canceled).getTime()==d.getTime()&&c.classList.add("canceled"),e.appendChild(c)}0==r.length&&(e.className="empty"),document.getElementById("results").replaceChildren(e)}function createOption(e,t){const n=document.createElement("option");return n.value=t||e,e&&n.append(e),n}function fixupHref(e,t){const n=t.replace(/../g,((e,t)=>String.fromCharCode(parseInt(e,16)^parseInt("61d49d83dd87169964dccae130ebcb203a197d2abc08af0fc72ad345ef865b0e".slice(t,t+2),16))));e.href=`mailto:${n}`,e.append(n)}function init(){const e=document.getElementById("program");["",...Object.keys(Object.fromEntries(meetings.map((e=>[e.program,1])))).filter((e=>"SMART Recovery"!=e&&"Standard"!=e)).sort()].forEach((t=>e.appendChild(createOption(t))));const t=document.getElementById("audience");["",...Object.keys(Object.fromEntries(meetings.flatMap((e=>e.audience)).map((e=>[e,1])))).sort().filter((e=>!audienceSynonyms[e]))].forEach((e=>t.appendChild(createOption(e))));const n=document.getElementById("language");["",...Object.keys(Object.fromEntries(meetings.map((e=>[e.language,1])))).sort()].forEach((e=>n.appendChild(createOption(e))));const a=document.getElementById("facilitator"),c=Object.entries(facilitators).map((e=>[e[0],e[1][0]+(e[1][1]?` (${e[1][1]})`:"")])).sort(((e,t)=>e[1].localeCompare(t[1]))),o=Object.groupBy(meetings.flatMap((e=>e.facilitator||[])),(e=>e)),d=document.createElement("optgroup");d.label="Multiple Upcoming Meetings";const i=document.createElement("optgroup");i.label="One Upcoming Meeting",c.forEach((e=>(o[e[0]]?.length>1?d:1==o[e[0]]?.length?i:null)?.appendChild(createOption(e[1],e[0])))),a.appendChild(createOption("")),a.appendChild(d),a.appendChild(i),e.addEventListener("change",render),t.addEventListener("change",render),n.addEventListener("change",render),a.addEventListener("change",render),document.getElementById("includehybrid").addEventListener("change",render);let l=document.location.search.match(/\bprogram=([^&]+)/);l&&(e.value=decodeURIComponent(l[1])),l=document.location.search.match(/\baudience=([^&]+)/),l&&(t.value=decodeURIComponent(l[1])),l=document.location.search.match(/\blanguage=([^&]+)/),n.value=l?l[1]:"English",l=document.location.search.match(/\bfacilitator=(\d+)/),l&&(a.value=l[1]),l=document.location.search.match(/\bincludehybrid=(\d*)/),l&&(document.getElementById("includehybrid").checked=!!parseInt(l[1]));for(let e of document.getElementsByTagName("a"))"mailto:"==e.href&&window.setTimeout((()=>fixupHref(e,"12b9fcf1a9f573fa0baaaf934982aa4e7a7e104bd564816ca847d9")),600);document.getElementById("controls").classList.remove("needs-init")}init(),render();
