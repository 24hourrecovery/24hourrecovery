const us=Object.fromEntries(["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","District of Columbia","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"].map(e=>[e,1])),ca=Object.fromEntries(["Alberta","British Columbia","Manitoba","New Brunswick","Newfoundland and Labrador","Northwest Territories","Nova Scotia","Nunavut","Ontario","Prince Edward Island","Quebec","Saskatchewan","Yukon"].map(e=>[e,1]));{let e=meetings.find(e=>"na"==e.dataSource&&7360==e.id);e&&(e.audience=["Adults Welcome"])}const audienceSynonyms={LGBT:"LGBTQIA+","LGBTIQ+ only":"LGBTQIA+","Men only":"Men","Women Only":"Women","Female only":"Women"};function flag(e,t){let a=[e];"na"==e?(t=t.replace(/.*, /,""),a=us[t]?["us"]:ca[t]?["ca"]:["us","ca"]):"uk"==e&&(a=["gb"]);const n={us:"USA",ca:"Canada",uk:"UK",au:"Australia"},i=document.createElement("div");return i.className="flagwrapper",a.forEach(e=>{var t=document.createElement("img");t.src=`img/${e}.svg`,t.alt=n[e],t.height=32,t.width=32,t.className="flag",i.appendChild(t)}),i}function partsToDiv(e){const a=document.createElement("div");return e.forEach(e=>{var t;"literal"==e.type?a.append(e.value):((t=document.createElement("span")).className=e.type.replace(/([A-Z])/,e=>"-"+e.toLowerCase()),t.append(e.value),a.appendChild(t))}),a}function findNextMeeting(e,t){if(!e?.time)return null;for(var a of[0,1]){var n,i=new Date,a=(i.setUTCHours(e.time.slice(0,2)),i.setUTCMinutes(e.time.slice(3,5)),i.setUTCSeconds(0),i.setUTCMilliseconds(0),i.setUTCMonth(i.getUTCMonth()+a),i.setUTCDate(1),(e.day-i.getUTCDay()+7)%7);i.setUTCDate(a+i.getUTCDate());for(n of e.week||"12345"){var o,d=new Date(i.getTime());if(-1!=n?d.setUTCDate(d.getUTCDate()+7*(n-1)):(d.setUTCMonth(d.getUTCMonth()+1),d.setUTCDate(1),o=(e.day-d.getUTCDay()+7)%7,d.setUTCDate(o+d.getUTCDate()-7)),d.getTime()+6e4*t>=(new Date).getTime())return d}}}function render(){var t=document.createElement("table");const a=document.createElement("tr");["Country","Time","Details","Location","Facilitator"].forEach(e=>{var t=document.createElement("th");t.append(e),a.appendChild(t)}),t.appendChild(a);var n=Intl.DateTimeFormat(void 0,{timeStyle:"short"}),i=Intl.DateTimeFormat(void 0,{weekday:"long",month:"long",day:"numeric"});const o=document.getElementById("program").value,d=document.getElementById("audience").value,c=document.getElementById("language").value,r=parseInt(document.getElementById("facilitator").value),l=document.getElementById("includehybrid").checked,m=meetings.filter(e=>(!o||e.program==o||"4-Point Recovery"==o&&("SMART Recovery"==e.program||"Standard"==e.program))&&(!d||e.audience.map(e=>audienceSynonyms[e]||e).includes(d))&&(!c||e.language==c)&&(!r||(e.facilitator||[]).includes(r))&&(l||"Online"==e.type)).filter(e=>!!e.schedule).map(e=>({...e,time:findNextMeeting(e.schedule,e.duration).toISOString()})).sort((e,t)=>e.time.localeCompare(t.time));var e=[],e=(o&&e.push("program="+encodeURIComponent(o)),d&&e.push("audience="+encodeURIComponent(d)),c&&e.push("language="+encodeURIComponent(c)),r&&e.push("facilitator="+encodeURIComponent(r)),l||e.push("includehybrid=0"),"?"+e.join("&"));history.replaceState(null,"",e);const s=Object.groupBy(meetings.flatMap(e=>e.facilitator||[]),e=>e),p=Object.groupBy(m.flatMap(e=>e.facilitator||[]),e=>e);for(let e of m){var u=document.createElement("tr"),h=document.createElement("td"),h=(h.appendChild(flag(e.dataSource,e.location)),u.appendChild(h),new Date(e.time)),g=new Date(h.getTime()+6e4*e.duration),f=document.createElement("td"),C=document.createElement("div"),E=partsToDiv(n.formatToParts(h)),E=(E.className="time start",C.appendChild(E),partsToDiv(n.formatToParts(g))),g=(E.className="time end",C.append(" - "),C.appendChild(E),(60<=e.duration?Math.floor(e.duration/60+1e-8)+"h":"")+("0"+e.duration%60).slice(-2)),E=document.createElement("div"),g=(E.className="duration",E.append(g),C.appendChild(E),f.appendChild(C),i.formatToParts(h)),E=(" "==g[3].value&&(g[3].value="Â "),partsToDiv(g)),C=(E.className="date",f.appendChild(E),u.appendChild(f),document.createElement("td")),g=(C.className="details",document.createElement("div"));g.append(e.program),C.appendChild(g);const y=document.createElement("div");e.audience.forEach((e,t)=>{var a=document.createElement("span");a.append(e),0<t&&y.append(", "),y.appendChild(a)}),C.appendChild(y);E=document.createElement("div"),f=(E.append(e.language),C.appendChild(E),u.appendChild(C),document.createElement("td"));f.className="location","Online"==e.type?((g=document.createElement("div")).append(e.type),f.appendChild(g),E=document.createElement("div"),"National"!=e.location&&(E.className="host"),E.append(e.location),f.appendChild(E)):((C=document.createElement("div")).append(e.location),f.appendChild(C),(g=document.createElement("div")).className="plus-online",g.append("+ Online"),f.appendChild(g));const v=document.createElement("td");e.facilitator&&e.facilitator.forEach((t,e)=>{var a=facilitators[t][0],n=document.createElement("span"),a=(n.append(a),n.className="facilitator",0<e&&v.append(", "),s[t]?.length||0);const i=p[t]?.length||0;1<i&&i<m.length?(n.classList.add("multiple-visible"),n.title="This facilitator runs other meetings, click to see them."):a>i&&(n.classList.add("multiple-filtered"),n.title="This facilitator runs other meetings but they are not currently displayed, click to see them."),n.title&&n.addEventListener("click",e=>{e.stopPropagation(),document.getElementById("facilitator").value=t,i<=1&&(document.getElementById("program").value="",document.getElementById("audience").value="",document.getElementById("language").value="",document.getElementById("includehybrid").checked=!0),render()}),v.appendChild(n)}),u.appendChild(f),u.appendChild(v),u.addEventListener("click",()=>window.open(`https://${"na"==e.dataSource?"":e.dataSource+"."}meetings.smartrecovery.org/meetings/${e.id}/`)),u.className="meeting",new Date(e.canceled).getTime()==h.getTime()&&u.classList.add("canceled"),t.appendChild(u)}0==m.length&&(t.className="empty"),document.getElementById("results").replaceChildren(t)}function createOption(e,t){var a=document.createElement("option");return a.value=t||e,e&&a.append(e),a}function fixupHref(e,t){t=t.replace(/../g,(e,t)=>String.fromCharCode(parseInt(e,16)^parseInt("61d49d83dd87169964dccae130ebcb203a197d2abc08af0fc72ad345ef865b0e".slice(t,t+2),16)));e.href="mailto:"+t,e.append(t)}function init(){const t=document.getElementById("program");["",...Object.keys(Object.fromEntries(meetings.map(e=>[e.program,1]))).filter(e=>"SMART Recovery"!=e&&"Standard"!=e).sort()].forEach(e=>t.appendChild(createOption(e)));const a=document.getElementById("audience"),n=(["",...Object.keys(Object.fromEntries(meetings.flatMap(e=>e.audience).map(e=>[e,1]))).sort().filter(e=>!audienceSynonyms[e])].forEach(e=>a.appendChild(createOption(e))),document.getElementById("language"));["",...Object.keys(Object.fromEntries(meetings.map(e=>[e.language,1]))).sort()].forEach(e=>n.appendChild(createOption(e)));var e=document.getElementById("facilitator"),i=Object.entries(facilitators).map(e=>[e[0],e[1][0]+(e[1][1]?` (${e[1][1]})`:"")]).sort((e,t)=>e[1].localeCompare(t[1]));const o=Object.groupBy(meetings.flatMap(e=>e.facilitator||[]),e=>e),d=document.createElement("optgroup"),c=(d.label="Multiple Upcoming Meetings",document.createElement("optgroup"));c.label="One Upcoming Meeting",i.forEach(e=>(1<o[e[0]]?.length?d:1==o[e[0]]?.length?c:null)?.appendChild(createOption(e[1],e[0]))),e.appendChild(createOption("")),e.appendChild(d),e.appendChild(c),t.addEventListener("change",render),a.addEventListener("change",render),n.addEventListener("change",render),e.addEventListener("change",render),document.getElementById("includehybrid").addEventListener("change",render);i=document.location.search.match(/\bprogram=([^&]+)/);i&&(t.value=decodeURIComponent(i[1])),(i=document.location.search.match(/\baudience=([^&]+)/))&&(a.value=decodeURIComponent(i[1])),i=document.location.search.match(/\blanguage=([^&]+)/),n.value=i?i[1]:"English",(i=document.location.search.match(/\bfacilitator=(\d+)/))&&(e.value=i[1]),(i=document.location.search.match(/\bincludehybrid=(\d*)/))&&(document.getElementById("includehybrid").checked=!!parseInt(i[1]));for(let e of document.getElementsByTagName("a"))"mailto:"==e.href&&window.setTimeout(()=>fixupHref(e,"12b9fcf1a9f573fa0baaaf934982aa4e7a7e104bd564816ca847d9"),600);document.getElementById("controls").classList.remove("needs-init")}init(),render();
