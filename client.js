!function(){let e=meetings.find((e=>"na"==e.dataSource&&7360==e.id));e&&(e.audience=["Adults Welcome"])}();const audienceSynonyms={LGBT:"LGBTQIA+","LGBTIQ+ only":"LGBTQIA+","Men only":"Men","Women Only":"Women","Female only":"Women"},baseUrls={au:"https://au.meetings.smartrecovery.org",uk:"https://uk.meetings.smartrecovery.org",na:"https://meetings.smartrecovery.org",ca:"https://meetings.smartrecovery-canada.ca",gl:"https://meetings.smartrecoveryglobal.org"};function flag(e,t){let n=[e];"na"==e?n=["us"]:"uk"==e&&(n=["gb"]);const a={us:"USA",ca:"Canada",uk:"UK",au:"Australia"},o=document.createElement("div");return o.className="flagwrapper",n.forEach((e=>{const t=document.createElement("img");t.src=`img/${e}.svg`,t.alt=a[e],t.height=32,t.width=32,t.className="flag",o.appendChild(t)})),o}function partsToDiv(e){const t=document.createElement("div");return e.forEach((e=>{if("literal"==e.type)t.append(e.value);else{const n=document.createElement("span");n.className=e.type.replace(/([A-Z])/,(e=>"-"+e.toLowerCase())),n.append(e.value),t.appendChild(n)}})),t}function findNextMeeting(e,t){if(!e?.time)return null;for(let n of[0,1]){const a=new Date;a.setUTCHours(e.time.slice(0,2)),a.setUTCMinutes(e.time.slice(3,5)),a.setUTCSeconds(0),a.setUTCMilliseconds(0),a.setUTCMonth(a.getUTCMonth()+n),a.setUTCDate(1);const o=(e.day-a.getUTCDay()+7)%7;a.setUTCDate(o+a.getUTCDate());for(let n of e.week||"12345"){const o=new Date(a.getTime());if(-1!=n)o.setUTCDate(o.getUTCDate()+7*(n-1));else{o.setUTCMonth(o.getUTCMonth()+1),o.setUTCDate(1);const t=(e.day-o.getUTCDay()+7)%7;o.setUTCDate(t+o.getUTCDate()-7)}if(o.getTime()+6e4*t>=(new Date).getTime())return o}}}function render(){const e=document.createElement("table"),t=document.createElement("tr");["Country","Time","Details","Location","Facilitator"].forEach((e=>{const n=document.createElement("th");n.append(e),t.appendChild(n)})),e.appendChild(t);const n=Intl.DateTimeFormat(void 0,{timeStyle:"short"}),a=Intl.DateTimeFormat(void 0,{weekday:"long",month:"long",day:"numeric"}),o=document.getElementById("program").value,c=document.getElementById("audience").value,d=document.getElementById("language").value,i=parseInt(document.getElementById("facilitator").value),l=document.getElementById("includehybrid").checked,r=meetings.filter((e=>(!o||e.program==o||"4-Point Recovery"==o&&("SMART Recovery"==e.program||"Standard"==e.program))&&(!c||e.audience.map((e=>audienceSynonyms[e]||e)).includes(c))&&(!d||e.language==d)&&(!i||(e.facilitator||[]).includes(i))&&(l||"Online"==e.type))).filter((e=>!!e.schedule)).map((e=>({...e,time:findNextMeeting(e.schedule,e.duration).toISOString()}))).sort(((e,t)=>e.time.localeCompare(t.time))),s=[];o&&s.push(`program=${encodeURIComponent(o)}`),c&&s.push(`audience=${encodeURIComponent(c)}`),d&&s.push(`language=${encodeURIComponent(d)}`),i&&s.push(`facilitator=${encodeURIComponent(i)}`),!l&&s.push("includehybrid=0");const m="?"+s.join("&");history.replaceState(null,"",m);const p=Object.groupBy(meetings.flatMap((e=>e.facilitator||[])),(e=>e)),u=Object.groupBy(r.flatMap((e=>e.facilitator||[])),(e=>e));for(let t of r){const o=document.createElement("tr"),c=document.createElement("td");c.appendChild(flag(t.dataSource,t.location)),o.appendChild(c);const d=new Date(t.time),i=new Date(d.getTime()+6e4*t.duration),l=document.createElement("td"),s=document.createElement("div"),m=partsToDiv(n.formatToParts(d));m.className="time start",s.appendChild(m);const g=partsToDiv(n.formatToParts(i));g.className="time end",s.append(" - "),s.appendChild(g);const h=(t.duration>=60?`${Math.floor(t.duration/60+1e-8)}h`:"")+("0"+t.duration%60).slice(-2),f=document.createElement("div");f.className="duration",f.append(h),s.appendChild(f),l.appendChild(s);const y=a.formatToParts(d);" "==y[3].value&&(y[3].value="Â ");const E=partsToDiv(y);E.className="date",l.appendChild(E),o.appendChild(l);const C=document.createElement("td");C.className="details";const v=document.createElement("div");v.append(t.program),C.appendChild(v);const T=document.createElement("div");t.audience.forEach(((e,t)=>{const n=document.createElement("span");n.append(e),t>0&&T.append(", "),T.appendChild(n)})),C.appendChild(T);const b=document.createElement("div");b.append(t.language),C.appendChild(b),o.appendChild(C);const I=document.createElement("td");if(I.className="location","Online"==t.type){const e=document.createElement("div");e.append(t.type),I.appendChild(e);const n=document.createElement("div");"National"!=t.location&&(n.className="host"),n.append(t.location),I.appendChild(n)}else{const e=document.createElement("div");e.append(t.location),I.appendChild(e);const n=document.createElement("div");n.className="plus-online",n.append("+ Online"),I.appendChild(n)}const U=document.createElement("td");t.facilitator&&t.facilitator.forEach(((e,t)=>{const n=facilitators[e][0],a=document.createElement("span");a.append(n),a.className="facilitator",t>0&&U.append(", ");const o=p[e]?.length||0,c=u[e]?.length||0;c>1&&c<r.length?(a.classList.add("multiple-visible"),a.title="This facilitator runs other meetings, click to see them."):o>c&&(a.classList.add("multiple-filtered"),a.title="This facilitator runs other meetings but they are not currently displayed, click to see them."),a.title&&a.addEventListener("click",(t=>{t.stopPropagation(),document.getElementById("facilitator").value=e,c<=1&&(document.getElementById("program").value="",document.getElementById("audience").value="",document.getElementById("language").value="",document.getElementById("includehybrid").checked=!0),render()})),U.appendChild(a)})),o.appendChild(I),o.appendChild(U),o.addEventListener("click",(()=>window.open(`${baseUrls[t.dataSource]}/meetings/${t.id}/`))),o.className="meeting",new Date(t.canceled).getTime()==d.getTime()&&o.classList.add("canceled"),e.appendChild(o)}0==r.length&&(e.className="empty"),document.getElementById("results").replaceChildren(e)}function createOption(e,t){const n=document.createElement("option");return n.value=t||e,e&&n.append(e),n}function fixupHref(e,t){const n=t.replace(/../g,((e,t)=>String.fromCharCode(parseInt(e,16)^parseInt("61d49d83dd87169964dccae130ebcb203a197d2abc08af0fc72ad345ef865b0e".slice(t,t+2),16))));e.href=`mailto:${n}`,e.append(n)}function init(){const e=document.getElementById("program");["",...Object.keys(Object.fromEntries(meetings.map((e=>[e.program,1])))).filter((e=>"SMART Recovery"!=e&&"Standard"!=e)).sort()].forEach((t=>e.appendChild(createOption(t))));const t=document.getElementById("audience");["",...Object.keys(Object.fromEntries(meetings.flatMap((e=>e.audience)).map((e=>[e,1])))).sort().filter((e=>!audienceSynonyms[e]))].forEach((e=>t.appendChild(createOption(e))));const n=document.getElementById("language");["",...Object.keys(Object.fromEntries(meetings.map((e=>[e.language,1])))).sort()].forEach((e=>n.appendChild(createOption(e))));const a=document.getElementById("facilitator"),o=Object.entries(facilitators).map((e=>[e[0],e[1][0]+(e[1][1]?` (${e[1][1]})`:"")])).sort(((e,t)=>e[1].localeCompare(t[1]))),c=Object.groupBy(meetings.flatMap((e=>e.facilitator||[])),(e=>e)),d=document.createElement("optgroup");d.label="Multiple Upcoming Meetings";const i=document.createElement("optgroup");i.label="One Upcoming Meeting",o.forEach((e=>(c[e[0]]?.length>1?d:1==c[e[0]]?.length?i:null)?.appendChild(createOption(e[1],e[0])))),a.appendChild(createOption("")),a.appendChild(d),a.appendChild(i),e.addEventListener("change",render),t.addEventListener("change",render),n.addEventListener("change",render),a.addEventListener("change",render),document.getElementById("includehybrid").addEventListener("change",render);let l=document.location.search.match(/\bprogram=([^&]+)/);l&&(e.value=decodeURIComponent(l[1])),l=document.location.search.match(/\baudience=([^&]+)/),l&&(t.value=decodeURIComponent(l[1])),l=document.location.search.match(/\blanguage=([^&]+)/),n.value=l?l[1]:"English",l=document.location.search.match(/\bfacilitator=(\d+)/),l&&(a.value=l[1]),l=document.location.search.match(/\bincludehybrid=(\d*)/),l&&(document.getElementById("includehybrid").checked=!!parseInt(l[1]));for(let e of document.getElementsByTagName("a"))"mailto:"==e.href&&window.setTimeout((()=>fixupHref(e,"12b9fcf1a9f573fa0baaaf934982aa4e7a7e104bd564816ca847d9")),600);document.getElementById("controls").classList.remove("needs-init")}init(),render();
